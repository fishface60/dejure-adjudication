##--################################################################
##	Dejure Adjudication Mod
##  By:			Occult Orison
##
##	Modified:	7/27/2015	v0.1		Occult Orison
##	  =Created
##		-Able to create Duchy/Kingdom/Empire from any title one 
##			rank lower
##		-If this increases rank, all realm titles one rank 
##			below will auto-magically de-jure drift into the new
##			title, unless the title they de-jure belong to already 
##			exists.
##		-The new title will try to copy the most appropriate laws
##		-Only top-liege can create new titles of equal or lesser rank
##			than his own.
##		-In such cases, only the base title will auto-magically 
##			de-jure drift into the new title
##		-It requires piety, prestige, cash, an able mind, and good 
##			standing with your religion head, and grants prestige
##		-It can not be repeated on the same base title
##		-Currently AI can only use this on their primary title
##		-AI always have a chance to do this, but it is low if they
##			aren't ambitious, proud, or prestigious, and ridiculously
##			low if content, humble, or lack prestige (0.0001/1)
##
##	Modified: 8/1/2015 		v0.2		Occult Orison
##		=Update
##			-Able to Re-Assign (Adjudicate) the de-jure liege of
##				county, duchy, and kingdom titles in realm
##			-Costs Prestige, Piety, Cash, and may upset holders of 
##				titles which lose de-jure vassal titles
##			-Addressed issue where you could create new titles from
##				lower titles not owned by you, despite the filter
##				being sub_realm_owned
##
##	Modified: 8/1/2015		v0.2.1		Occult Orison
##		=Minor Update
##			-Moved defines into own file for compatibility 
##
##	Modified: 8/1/2015		v0.3		Occult Orison
##		=Update
##			-Addressed issue where a title could be transferred to 
##				its current de jure liege title
##			-Addressed issue where vassal could change the designate 
##			-Added English localisation text for everything
##			-Fixed bug where transferring kingdoms into new empires
##				were attempting to transfer into the designated kingdom
##
##	Modified: 8/2/2015		v0.4		Occult Orison
##		=Update
##			-Realized the sub_realm_owned filter does not work at all, and 
##				added requirements to all decisions to fix this, which
##				means now you can't designate recipient titles outside
##				your realm
##			-Fixed it so that you can not de jure drift titles out 
##				of their original titles if any liege above that title
##				exists, not just the immediate liege. The exception
##				being if you move it to a title that shares the de jure
##				liege of the previous one. Ex: As Lombardy in CM start
##				you can move the county of benevento into the duchy of capua
##				(which has the same de jure liege as duchy of benevento)
##				but not into the duchy of latinum (different de jure liege)
##			-The approval of your religious head requirement now
##				applies to your rightful religious head. Which means
##				your anti-pope or patriarch if you have one instead.
##			-Added the ability to create titular titles instead of de jure.
##				It acts the same and has the same requirements, only 
##				nothing de jure drifts into the new title. The title will
##				still be a de jure vassal to the correct liege
##				Ex: titular duchy from a county won't have that county
##				as a de jure vassal but will be a de jure vassal of the
##				kingdom that county belongs to.
##	
##	Modified: 8/6/2015		v0.4.1		Occult Orison
##		=Minor Update
##			-Created non-functional duplicates of Form Kingdom/Empire decisons
##				to intentionally break them so that I can disable them
##				without overriding realm_decisions.txt
##	
##	Modified: 8/6/2015		v0.4.2		Occult Orison
##		=Minor Update
##			-Re-reenabled the Form Kingdom/Empire decisons because disabling
##				them was too ugly
##
##	Modified: 8/24/2015		v0.5.0		Richard Maw
##		=Big Update
##			-Fancy new mechanism for determining the recipient title.
##
##				Rather than setting a title flag, which implies
##				only one concurrent user of the feature, this
##				takes an approach inspired by relational
##				databases.
##
##				The first time a title is designated as a
##				recipient, a unique numeric ID is determined by
##				scanning all the current titles, finding the
##				one with the largest ID, and then saving a
##				value one larger as the ID for the new
##				recipient title's scope.
##
##				This forms an auto-incrementing table of titles.
##
##				The value in the title is then copied into the
##				character's scope, allowing each character to
##				have a different notion of their designated
##				title.
##
##				This is a one to many relationship between
##				characters and titles, where many characters
##				can hold a reference to the same title, such as
##				if both the title owner and their liege wanted
##				to assign a title to it.
##
##				The decision to assign a title to the recipient
##				then works by searching through all the titles
##				and checking if they have the same ID as the
##				character instigating the title assignment.
##
##				This would be a lot easier if there were a
##				mechanism to store a reference to a scope in
##				another scope (like a generic event target
##				mechanism),
##				and it would be possible to bring back per-rank
##				designated titles if set_variable and
##				is_variable_equal allowed both a separate scope
##				to compare, and the name of the variable in
##				that scope.
##
##				TODO: Fix commented out code.
##				TODO: Fix trailing whitespace.
##				TODO: Factor out duplicated logic.
##
##			-Allowed the assignment of titles when a vassal.
##
##				TODO: Creation of custom titles when a vassal is not yet allowed.
##
##			-Allow the assignment to titles that are not yet created.
##
##				You must completely control all the de-jure
##				territory of the title if you don't directly or
##				indirectly control the title itself.
##
##				Inactive titles, such as the Kingdom of Leon in
##				early start dates, may not be assigned to or
##				have other titles assigned to them, even if you
##				completely control the de-jure territory, or
##				the titular capital when it has no de-jure
##				territory.
##
##				Due to technical limitations, you must still
##				create titles that you want to designate as the
##				recipient title.
##
##			-Allow assignment when a title has no de-jure Liege
##
##				All assignments check whether there is a legal
##				inhibition against it, by if any de-jure liege
##				title is held by someone else.
##
##				Unfortunately there was a bug in this logic, as
##				empire={} will return false if the Kingdom has
##				no de-jure Empire, such as custom Kingdoms that
##				have since been destroyed, or some religious
##				head titles.
##
##				Similarly, you can have duchies without a
##				de-jure Kingdom when a custom Duchy title is
##				destroyed, most religious head titles, and a
##				few special titular titles.
##
##				This is fixed by flipping the logic around, so
##				rather than checking that the de-jure liege is
##				unheld or is held by you or a vassal, that you
##				check whether there isn't a liege title held by
##				someone out of your control.
##
##
##	Readme:
##			Decisions to replace and augment the "Form New 
##		Kingdom/Empire" decisions from CM Dlc to use targeted 
##		decisions on titles. 
##			You have my permission to reuse my work as long as I am 
##		credited, but idk how I would stop you anyways.
##			If you find any bugs or I have done something 
##		embarrassing, please inform me, thanks!
##--################################################################
# Title decisions are possible vs _all_ titles and are shown in the Title Diplomacy View, not the Intrigue View. The taker is in the FROM scope.
#
# filter = [capital/primary_title/owned/vassal_owned/sub_realm_owned/realm_owned/dynasty_owned/all]
# ai_target_filter = [capital/primary_title/owned/vassal_owned/sub_realm_owned/realm_owned/dynasty_owned/all] (which titles for which the AI evaluates the decision.)
#	owned: all titles owned by the AI
#	vassal_owned: all titles owned by direct vassal rulers of the AI's employer
#	sub_realm_owned: all titles below the AI's employer
#	realm_owned: all titles in the same top realm as the AI
#	dynasty_owned: all titles owned by members of the same dynasty
#	all: all titles (Avoid if possible. VERY CPU-HEAVY!)
#	

##--################################################################
##	Template
##--################################################################
	# #Decision Name
	# decision_name = {
		# #Filter Block - Ai Filter Block
		# filter = sub_realm_owned
		# ai_target_filter = sub_realm_owned
		
		# #From potential Block - "The Decider"
		# from_potential = {
			# #is_nomadic = yes
			# #has_dlc = "Horse Lords"
		# }
		
		# #Potential Block - Title in Question
		# potential = {
			# #tier = COUNT #Title Tier 
			# #location = { #location refers to title
			# #	owner = {
			# #		same_realm = FROM
			# #	}
			# #	any_neighbor_province = {
			# #		owner = {
			# #			NOT = { same_realm = FROM }
			# #		}
			# #	}
			# #}
		# }
		
		# #Allow Block
		# allow = {
			# #NOT = { num_of_settlements = 1 }
			# #has_siege = no
			# #FROM = {
			# #	war = no
			# #}
			# #location = {
			# #	NOT = { has_province_modifier = nomads_exploited_land }
			# #}
		# }
		
		# #Effect Block
		# effect = {
			# #holder_scope = {
			# #	capital_holding = {
			# #		add_holding_modifier = {
			# #			modifier = nomad_population_boom
			# #			years = 8
			# #			stacking = yes
			# #		}
			# #	}
			# #}
			# #location = {
			# #	add_province_modifier = {
			# #		modifier = nomads_exploited_land
			# #		years = 8
			# #	}
			# #}
		# }
		# #Revoke Allowed Block?
		# revoke_allowed = {
			# always = no
		# }
		# #Ai Will Do Block
		# ai_will_do = {
			# factor = 0
		# }
	# }
##	/Template

title_decisions = {

##--################################################################
##	Designate Title As Title Recipient
##--################################################################

	da_designate_recipient_title = {
		#Filter Block - Ai Filter Block
		filter = realm_owned
		ai_target_filter = primary_title
		
		#From potential Block - "The Decider"
		from_potential = {
			ai = no
			#is_nomadic = yes
			#has_dlc = "Horse Lords"
		}
		
		#Potential Block - Title in Question
		potential = {
			OR = {
				real_tier = DUKE
				real_tier = KING
				real_tier = EMPEROR
			}

			# Technical limitation, you can't assign to a title
			# without a holder, because it is not part of the
			# any_realm_title scope, and use of any_title in the
			# trigger instead causes CK2 to crash.
			has_holder = yes

			holder_scope = {
				OR = {
					character = FROM
					any_liege = {
						character = FROM
					}
				}
			}
		}
		
		#Allow Block
		allow = {
			#custom_tooltip = {
				#text = da_ttip_is_current_designate
				#hidden_tooltip = {
					# Either no recipient ID set, or it is
					# set on title and FROM either doesn't
					# have a flag, or does and has different ID.
					OR = {
						NOT = { da_has_title_id = yes }
						AND = {
							da_has_title_id = yes
							NOT = { is_variable_equal = { which = da_title_id which = FROM } }
						}
					}
				#}
			#}
			FROM = {
				#custom_tooltip = {
					#text = da_ttip_adult_free_capable_independent
					#hidden_tooltip = {
						is_adult = yes
						prisoner = no
						NOT = { trait = incapable }
						#independent = yes # TODO: Remove independent check
					#}
				#}
			}
		}
		
		#Effect Block
		effect = {
			ROOT = {
				custom_tooltip = {
					text = da_ttip_this_is_designated_title
					#hidden_tooltip = {
						if = {
							limit = { NOT = { da_has_title_id = yes } }
							da_assign_title_id = yes
						}
						FROM = {
							set_variable = { which = da_title_id which = ROOT }
							set_character_flag = da_has_title_recipient_id
						}
					#}
				}
			}
		}
		#Revoke Allowed Block?
		revoke_allowed = {
			always = no
		}
		#Ai Will Do Block
		ai_will_do = {
			factor = 0
		}
	}
## 	/Designate Title As Recipient

##--################################################################
##	Transfer County to Recipient Duchy 
##--################################################################
	da_transfer_county_to_recipient_duchy = {
		#Filter Block - Ai Filter Block
		filter = realm_owned
		ai_target_filter = primary_title
		
		#From potential Block - "The Decider"
		from_potential = {
			ai = no
			higher_real_tier_than = COUNT
			has_dlc = "Charlemagne"
			is_playable = yes
		}
		
		#Potential Block - Title in Question
		potential = {
			real_tier = COUNT
			FROM = { ROOT = { da_title_potential_transfer = yes } }
		}
		
		#Allow Block
		allow = {
			FROM = {
				#custom_tooltip = {
					#text = da_ttip_one_is_designated
					#hidden_tooltip = {
						has_character_flag = da_has_title_recipient_id
						any_realm_title = {
							AND = {
								real_tier = DUKE
								ROOT = { FROM = { da_is_recipient_not_dejure = yes } }
							}
						}
					#}
				#}
				is_adult = yes
				prisoner = no
				NOT = { trait = incapable }
				prestige = 100
				piety = 100
				wealth = 50
			}
			#hidden_tooltip = {
				ROOT = {
					AND = {
						#custom_tooltip = {
							#text = da_ttip_control_the_current_dejure_duchy
							#hidden_tooltip = {
								location = {
									duchy = {
										OR = {
											has_holder = no
											holder_scope = {
												OR = { 
													character = FROM
													any_liege = {
														character = FROM
													}
												}
											}
										}
										NOT = { kingdom = { NOT = {
											OR = {
												has_holder = no
												holder_scope = {
													OR = { 
														character = FROM
														any_liege = {
															character = FROM
														}
													}
												}
											}
											NOT = { empire = { NOT = {
												OR = {
													has_holder = no
													holder_scope = {
														OR = { 
															character = FROM
															any_liege = {
																character = FROM
															}
														}
													}
												}
											} } }
										} } }
									}
								}
							#}
						#}
						custom_tooltip = {
							text = da_ttip_control_the_current_target
							hidden_tooltip = {
								OR = {
									has_holder = no
									holder_scope = {
										OR = {
											character = FROM
											any_liege = {
												character = FROM
											}
										}
									}
								}
							}	
						}
					}
				}
			#}
		}
		#Effect Block
		effect = {
			FROM = {
				if = {
					limit = {
						ROOT = {
							duchy = {
								AND = {
									has_holder = yes
									NOT = {
										holder_scope = {
											character = FROM
										}
									}
								}
							}
						}
					}
					ROOT = {
						duchy = {
							holder_scope = {
								opinion = {
									modifier = opinion_tyrant
									who = FROM
								}
							}
						}
					}
				}
				
				any_title_under = {
					limit = {
						da_has_title_id = yes
						is_variable_equal = { which = da_title_id which = FROM }
					}
					custom_tooltip = {
						text = da_ttip_transfer
						hidden_tooltip = {
							ROOT = {
								de_jure_liege = PREV
							}
						}
					}
				}
				wealth = -50
				piety = -100
				prestige = -100
			}
		}
		#Revoke Allowed Block?
		revoke_allowed = {
			always = no
		}
		#Ai Will Do Block
		ai_will_do = {
			factor = 0
		}
	}
## 	/Transfer County to Recipient Duchy

##--################################################################
##	Transfer Duchy to Recipient Kingdom 
##--################################################################
	da_transfer_duchy_to_recipient_kingdom = {
		#Filter Block - Ai Filter Block
		filter = realm_owned
		ai_target_filter = primary_title
		
		#From potential Block - "The Decider"
		from_potential = {
			ai = no
			higher_real_tier_than = DUKE
			has_dlc = "Charlemagne"
			is_playable = yes
		}
		
		#Potential Block - Title in Question
		potential = {
			real_tier = DUKE
			FROM = { ROOT = { da_title_potential_transfer = yes } }
		}
		
		#Allow Block
		allow = {
			FROM = {
				custom_tooltip = {
					text = da_ttip_one_is_designated
					hidden_tooltip = {
						has_character_flag = da_has_title_recipient_id
						any_realm_title = {
							AND = {
								real_tier = KING
								ROOT = { FROM = { da_is_recipient_not_dejure = yes } }
							}
						}
					}
				}
				is_adult = yes
				prisoner = no
				NOT = { trait = incapable }
				prestige = 200
				piety = 200
				wealth = 100
			}
			#hidden_tooltip = {
				ROOT = {
					AND = {
						#custom_tooltip = {
							#text = da_ttip_control_the_current_dejure_kingdom
							#hidden_tooltip = {
								NOT = { kingdom = { NOT = {
									OR = {
										has_holder = no
										holder_scope = {
											OR = { 
												character = FROM
												any_liege = {
													character = FROM
												}
											}
										}
									}
									NOT = { empire = { NOT = {
										OR = {
											has_holder = no
											holder_scope = {
												OR = { 
													character = FROM
													any_liege = {
														character = FROM
													}
												}
											}
										}
									} } }
								} } }
							#}
						#}
						custom_tooltip = {
							text = da_ttip_control_the_current_target
							hidden_tooltip = {
								OR = {
									has_holder = no
									holder_scope = {
										OR = { 
											character = FROM
											any_liege = {
												character = FROM
											}
										}
									}
								}
							}
						}
					}
				}
			#}
		}
		#Effect Block
		effect = {
			FROM = {
				if = {
					limit = {
						ROOT = {
							kingdom = {
								AND = {
									has_holder = yes
									NOT = {
										holder_scope = {
											character = FROM
										}
									}
								}
							}
						}
					}
					ROOT = {
						kingdom = {
							holder_scope = {
								opinion = {
									modifier = opinion_tyrant
									who = FROM
								}
							}
						}
					}
				}
				
				any_title_under = {
					limit = {
						da_has_title_id = yes
						is_variable_equal = { which = da_title_id which = FROM }
					}
					custom_tooltip = {
						text = da_ttip_transfer
						hidden_tooltip = {
							ROOT = {
								de_jure_liege = PREV
							}
						}
					}
				}
				wealth = -100
				piety = -200
				prestige = -200
			}
		}
		#Revoke Allowed Block?
		revoke_allowed = {
			always = no
		}
		#Ai Will Do Block
		ai_will_do = {
			factor = 0
		}
	}
## 	/Transfer Duchy to Recipient Kingdom

##--################################################################
##	Transfer Kingdom to Recipient Empire 
##--################################################################
	da_transfer_kingdom_to_recipient_empire = {
		#Filter Block - Ai Filter Block
		filter = realm_owned
		ai_target_filter = primary_title
		
		#From potential Block - "The Decider"
		from_potential = {
			ai = no
			higher_real_tier_than = KING
			has_dlc = "Charlemagne"
			is_playable = yes
		}
		
		#Potential Block - Title in Question
		potential = {
			real_tier = KING
			FROM = { ROOT = { da_title_potential_transfer = yes } }
		}
		
		#Allow Block
		allow = {
			FROM = {
				#custom_tooltip = {
					#text = da_ttip_one_is_designated
					#hidden_tooltip = {
						has_character_flag = da_has_title_recipient_id
						any_realm_title = {
							AND = {
								real_tier = EMPEROR
								ROOT = { FROM = { da_is_recipient_not_dejure = yes } }
							}
						}
					#}
				#}
				is_adult = yes
				prisoner = no
				NOT = { trait = incapable }
				prestige = 400
				piety = 400
				wealth = 200
			}
			#hidden_tooltip = {
				ROOT = {
					AND = {
						custom_tooltip = {
							text = da_ttip_control_the_current_dejure_empire
							hidden_tooltip = {
								NOT = { empire = { NOT = {
									OR = {
										has_holder = no
										holder_scope = {
											OR = { 
												character = FROM
												any_liege = {
													character = FROM
												}
											}
										}
									}
								} } }
							}
						}
						custom_tooltip = {
							text = da_ttip_control_the_current_target
							hidden_tooltip = {
								OR = {
									has_holder = no
									holder_scope = {
										OR = { 
											character = FROM
											any_liege = {
												character = FROM
											}
										}
									}
								}
							}
						}
					}
				}
			#}
		}
		#Effect Block
		effect = {
			FROM = {
				any_title_under = {
					limit = {
						da_has_title_id = yes
						is_variable_equal = { which = da_title_id which = FROM }
					}
					custom_tooltip = {
						text = da_ttip_transfer
						hidden_tooltip = {
							ROOT = {
								de_jure_liege = PREV
							}
						}
					}
				}
				wealth = -200
				piety = -400
				prestige = -400
			}
		}
		#Revoke Allowed Block?
		revoke_allowed = {
			always = no
		}
		#Ai Will Do Block
		ai_will_do = {
			factor = 0
		}
	}
## 	/Transfer Kingdom to Recipient Empire





##--################################################################
##	Create Duchy From County
##--################################################################
	da_create_duchy = {
		#Filter Block - Ai Filter Block
		filter = realm_owned
		ai_target_filter = primary_title 
		
		#From potential Block - "The Decider"
		from_potential = {
			higher_real_tier_than = BARON
			has_dlc = "Charlemagne"
			is_playable = yes
		}
		#Potential Block - Title in Question
		potential = {
			is_title_active = yes
			real_tier = COUNT
			holder_scope = {
				OR = { 
					character = FROM
					any_liege = {
						character = FROM
					}
				}
			}
			#holder_scope = {character = FROM}
		}
		
		#Allow Block
		allow = {
			FROM = {
				custom_tooltip = {
					text = da_ttip_adult_free_capable_independent
					hidden_tooltip = {
						is_adult = yes
						prisoner = no
						NOT = { trait = incapable }
						independent = yes
					}
				}
				prestige = 200
				piety = 200
				wealth = 200
				custom_tooltip = {
					text = da_ttip_relighead_approve50
					hidden_tooltip = {
						OR = {
							rightful_religious_head_scope = {
								opinion = { who = FROM value = 50 }
							}
							NOT = {
								rightful_religious_head_scope = {
									always = yes
								}
							}
						}
					}
				}		
				custom_tooltip = {
					text = da_ttip_duke_realm_size
					hidden_tooltip = {
						OR = {
							realm_size = 8
							any_demesne_title = {
								count = 3
								real_tier = COUNT
							}
							any_demesne_title = {
								count = 1
								higher_real_tier_than = COUNT
							}
						}
					}
				}
			}
			ROOT = {
				custom_tooltip = {
					text = da_ttip_previously_created_from
					hidden_tooltip = {
						NOT = {has_title_flag = customtitle_created}
					}
				}
			}
		}
		
		#Effect Block
		effect = {
			FROM = {
				#New Title
				ROOT = {
					create_title = {
						tier = DUKE
						landless = no
						temporary = no
						custom_created = yes
						culture = FROM
						holder = FROM
						base_title = THIS
						copy_title_laws = yes
					}
					hidden_tooltip = {
						new_title = {	
							set_variable = {
								which = "customtitle_findme"
								value = 1
							}
						}
						FROM = {
							primary_title = {
								ROOT = {
									kingdom = {
										FROM = {
											any_demesne_title = {
												limit = {
													real_tier = DUKE
													check_variable = {which = "customtitle_findme" value = 1} 
												}
												de_jure_liege = PREVPREV
												
												if = {
													limit = {
														FROM = {
															any_demesne_title = {
																count = 2
																higher_real_tier_than = COUNT
															}	
														}
													}
													copy_title_laws = PREVPREVPREVPREV
													if = {
														limit = {
															ROOT = {
																location = {
																	duchy = {
																		OR = {
																			has_holder = no
																			holder_scope = {
																				OR = { 
																					character = FROM
																					any_liege = {
																						character = FROM
																					}
																				}
																			}
																		}
																	}
																}
															}
														}
														ROOT = 
														{
															 de_jure_liege = PREV
														}
													}
												}
												if = {
													limit = {
														NOT = {
															FROM = {
																any_demesne_title = {
																	count = 2
																	higher_real_tier_than = COUNT
																}
															}	
														}
													}
													holder_scope = {
														any_title_under = {
															limit = {
																real_tier = COUNT
																location = {
																	duchy = {
																		has_holder = no
																	}
																}	
															}
															de_jure_liege = PREVPREV
														}
														any_title_under = {
															limit = {
																real_tier = COUNT
																location = {
																	duchy = {
																			has_holder = no
																	}
																	NOT = { de_jure_liege_or_above = PREVPREVPREV }
																	FROM = {
																		completely_controls = PREV
																	}
																}
															}
															location = {
																de_jure_liege = PREVPREVPREV
															}
														}
													}
												}
												set_variable = {
													which = "customtitle_findme"
													value = 0
												}
											}
										}
									}
								}
							}
						}
						set_title_flag = customtitle_created
					}
				}
				#Costs
				wealth = -200
				piety = -200
				prestige = 200
				custom_tooltip = { text = da_ttip_new_duchy }
				#chronicle = {
				#	entry = CHRONICLE_FOUNDED_NEW_KINGDOM_OR_EMPIRE
				#	portrait = [From.GetID]
				#}
			}
		}
		#Revoke Allowed Block?
		revoke_allowed = {
			always = no
		}
		#Ai Will Do Block
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.25
			}
			modifier = {
				factor = 0.01
				FROM = { trait = content }
			}
			modifier = {
				factor = 0.1
				FROM = {trait = humble}
			}		
			modifier = {
				factor = 2
				FROM = {trait = ambitious}
			}		
			modifier = {
				factor = 1.5
				FROM = {trait = proud}
			}		
			modifier = {
				factor = 0.1
				NOT = {
					FROM = {prestige = 500}
				}
			}
			modifier = {
				factor = 1.5
				FROM = {prestige = 1000}
			}
			modifier = {
				factor = 2
				FROM = {prestige = 2000}
			}
			modifier = {
				factor = 6.5
				FROM = {prestige = 4000}
			}
		}
	}
##	/Create Duchy



##--################################################################
##	Create Kingdom From Duchy
##--################################################################
	da_create_kingdom = {
		#Filter Block - Ai Filter Block
		filter = realm_owned
		ai_target_filter = primary_title 
		
		#From potential Block - "The Decider"
		from_potential = {
			higher_real_tier_than = COUNT
			has_dlc = "Charlemagne"
			is_playable = yes
		}
		#Potential Block - Title in Question
		potential = {
			is_title_active = yes
			real_tier = DUKE
			OR = {
				AND = {
					has_holder = no
					FROM = { completely_controls = ROOT }
				}
				holder_scope = {
					OR = { 
						character = FROM
						any_liege = {
							character = FROM
						}
					}
				}
			}
			#holder_scope = {character = FROM}
		}
		
		#Allow Block
		allow = {
			FROM = {
				custom_tooltip = {
					text = da_ttip_adult_free_capable_independent
					hidden_tooltip = {
						is_adult = yes
						prisoner = no
						NOT = { trait = incapable }
						independent = yes
					}
				}
				prestige = 400
				piety = 200
				wealth = 400
				custom_tooltip = {
					text = da_ttip_relighead_approve75
					hidden_tooltip = {
						OR = {
							rightful_religious_head_scope = {
								opinion = { who = FROM value = 75 }
							}
							NOT = {
								rightful_religious_head_scope = {
									always = yes
								}
							}
						}
					}
				}		
				custom_tooltip = {
					text = da_ttip_king_realm_size
					hidden_tooltip = {
						OR = {
							realm_size = 35
							any_demesne_title = {
								count = 3
								real_tier = DUKE
							}
							any_demesne_title = {
								count = 1
								higher_real_tier_than = DUKE
							}
						}
					}
				}
			}
			ROOT = {
				custom_tooltip = {
					text = da_ttip_previously_created_from
					hidden_tooltip = {
						NOT = { has_title_flag = customtitle_created}
					}
				}
			}
		}
		#Effect Block
		effect = {
			FROM = {
				#New Title
				ROOT = {
					create_title = {
						tier = KING
						landless = no
						temporary = no
						custom_created = yes
						culture = FROM
						holder = FROM
						base_title = THIS
						copy_title_laws = yes
					}
					hidden_tooltip = {
						new_title = {	
							set_variable = {
								which = "customtitle_findme"
								value = 1
							}
						}
						FROM = {
							primary_title = {
								ROOT = {
									empire = {
										FROM = {
											any_demesne_title = {
												limit = {
													real_tier = KING
													check_variable = {which = "customtitle_findme" value = 1} 
												}
												de_jure_liege = PREVPREV
												if = {
													limit = {
														FROM = {
															any_demesne_title = {
																count = 2
																higher_real_tier_than = DUKE
															}	
														}
													}
													copy_title_laws = PREVPREVPREVPREV
													if = {
														limit = {
															ROOT = {
																kingdom = {
																	OR = {
																		has_holder = no
																		holder_scope = {
																			character = FROM
																		}
																	}
																}
															}
														}
														ROOT = {
															de_jure_liege = PREV
														}
													}
												}
												if = {
													limit = {
														NOT = {
															FROM = {
																any_demesne_title = {
																	count = 2
																	higher_real_tier_than = DUKE
																}
															}	
														}
													}
													holder_scope = {
														any_title_under = {
															limit = {
																real_tier = DUKE
																kingdom = {
																	has_holder = no
																}
															}
															de_jure_liege = PREVPREV
														}
														any_title_under = {
															limit = {
																real_tier = COUNT
																location = {
																	duchy = {
																		kingdom = {
																			has_holder = no
																		}
																		NOT = { de_jure_liege_or_above = PREVPREVPREVPREV }
																		FROM = {
																			completely_controls = PREV
																		}
																	}
																}
															}
															location = {
																duchy = {
																	de_jure_liege = PREVPREVPREVPREV
																}
															}
														}
													}
												}
												set_variable = {
													which = "customtitle_findme"
													value = 0
												}
											}
										}
									}
								}
							}
						}
						set_title_flag = customtitle_created
					}
				}
				#Costs
				if = {
					limit = {
						piety = 1000
					}
					wealth = -200
				}
				if = {
					limit = {
						AND = {
							piety = 800
							NOT = { piety = 1000}
						}
					}
					wealth = -250
				}
				if = {
					limit = {
						AND = {
							piety = 600
							NOT = { piety = 800}
						}
					}
					wealth = -300
				}
				if = {
					limit = {
						AND = {
							piety = 400
							NOT = { piety = 600}
						}
					}
					wealth = -350
				}
				if = {
					limit = {
						NOT = { piety = 400}
					}
					wealth = -400
				}
				piety = -200
				prestige = 400
				custom_tooltip = { text = form_new_kingdom_tooltip }
				chronicle = {
					entry = CHRONICLE_FOUNDED_NEW_KINGDOM_OR_EMPIRE
					portrait = [From.GetID]
				}
			}
		}
		#Revoke Allowed Block?
		revoke_allowed = {
			always = no
		}
		#Ai Will Do Block
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.25
			}
			modifier = {
				factor = 0.01
				FROM = { trait = content }
			}
			modifier = {
				factor = 0.1
				FROM = {trait = humble}
			}		
			modifier = {
				factor = 2
				FROM = {trait = ambitious}
			}		
			modifier = {
				factor = 1.5
				FROM = {trait = proud}
			}		
			modifier = {
				factor = 0.1
				NOT = {
					FROM = {prestige = 1000}
				}
			}
			modifier = {
				factor = 1.5
				FROM = {prestige = 2000}
			}
			modifier = {
				factor = 2
				FROM = {prestige = 4000}
			}
			modifier = {
				factor = 6.5
				FROM = {prestige = 8000}
			}
		}
	}
##	/Create Kingdom


##--################################################################
##	Create Empire From Kingdom
##--################################################################
	da_create_empire = {
		#Filter Block - Ai Filter Block
		filter = realm_owned
		ai_target_filter = primary_title 
		
		#From potential Block - "The Decider"
		from_potential = {
			higher_real_tier_than = DUKE
			has_dlc = "Charlemagne"
			is_playable = yes
			is_nomadic = no
		}
		#Potential Block - Title in Question
		potential = {
			is_title_active = yes
			real_tier = KING
			OR = {
				AND = {
					has_holder = no
					FROM = { completely_controls = ROOT }
				}
				holder_scope = {
					OR = { 
						character = FROM
						any_liege = {
							character = FROM
						}
					}
				}
			}
			#holder_scope = {character = FROM}
		}
		#Allow Block
		allow = {
			FROM = {
				custom_tooltip = {
					text = da_ttip_adult_free_capable_independent
					hidden_tooltip = {
						is_adult = yes
						prisoner = no
						NOT = { trait = incapable }
						independent = yes
					}
				}
				prestige = 800
				piety = 400
				wealth = 800
				custom_tooltip = {
					text = da_ttip_relighead_approve100
					hidden_tooltip = {
						OR = {
							rightful_religious_head_scope = {
								opinion = { who = FROM value = 100 }
							}
							NOT = {
								rightful_religious_head_scope = {
									always = yes
								}
							}
						}
					}
				}		
				custom_tooltip = {
					text = da_ttip_emperor_realm_size
					hidden_tooltip = {
						OR = {
							realm_size = 180
							any_demesne_title = {
								count = 3
								real_tier = KING
							}
							any_demesne_title = {
								count = 1
								higher_real_tier_than = KING
							}
						}
					}
				}
			}
			ROOT = {
				custom_tooltip = {
					text = da_ttip_previously_created_from
					hidden_tooltip = {
						NOT = { has_title_flag = customtitle_created}
					}
				}
			}
		}
		#Effect Block
		effect = {
			FROM = {
				#New Title
				ROOT = {
					create_title = {
						tier = EMPEROR
						landless = no
						temporary = no
						custom_created = yes
						culture = FROM
						holder = FROM
						base_title = THIS
						copy_title_laws = yes
					}
					hidden_tooltip = {
						new_title = {	
							set_variable = {
								which = "customtitle_findme"
								value = 1
							}
						}
						FROM = {
							primary_title = {
								holder_scope = {
									any_demesne_title = {
										limit = {
											real_tier = EMPEROR
											check_variable = {which = "customtitle_findme" value = 1} 
										}
										if = {
											limit = {
												FROM = {
													any_demesne_title = {
														count = 2
														higher_real_tier_than = KING #WHY!?!?!?!?!?!
													}	
												}
											}
											copy_title_laws = PREVPREV
											if = {
												limit = {
													ROOT = {
														empire = {
															OR = {
																has_holder = no
																holder_scope = {
																	character = FROM
																}
															}
														}
													}
												}
												ROOT = {
													de_jure_liege = PREV
												}
											}
										}
										if = {
											limit = {
												NOT = {
													FROM = {
														any_demesne_title = {
															count = 2
															higher_real_tier_than = KING
														}
													}	
												}
											}
											holder_scope = {
												any_title_under = {
													limit = {
														real_tier = KING
														empire = {
															has_holder = no
														}
													}
													de_jure_liege = PREVPREV
												}
												any_title_under = {
													limit = {
														real_tier = DUKE
														location = {
															kingdom = {
																empire = {
																	has_holder = no
																}
																NOT = { de_jure_liege_or_above = PREVPREVPREVPREV }
																FROM = {
																	completely_controls = PREV
																}
															}
														}
													}
													location = {
														kingdom = {
															de_jure_liege = PREVPREVPREVPREV
														}
													}
												}
											}
										}
										set_variable = {
											which = "customtitle_findme"
											value = 0
										}
									}
								}
							}
						}
						set_title_flag = customtitle_created
					}
				}
				#Costs
				if = {
					limit = {
						piety = 1200
					}
					wealth = -400
				}
				if = {
					limit = {
						AND = {
							piety = 1000
							NOT = { piety = 1200}
						}
					}
					wealth = -500
				}
				if = {
					limit = {
						AND = {
							piety = 800
							NOT = { piety = 1000}
						}
					}
					wealth = -600
				}
				if = {
					limit = {
						AND = {
							piety = 600
							NOT = { piety = 800}
						}
					}
					wealth = -700
				}
				if = {
					limit = {
						NOT = { piety = 600}
					}
					wealth = -800
				}
				piety = -400
				prestige = 800
				custom_tooltip = { text = form_new_empire_tooltip }
				chronicle = {
					entry = CHRONICLE_FOUNDED_NEW_KINGDOM_OR_EMPIRE
					portrait = [From.GetID]
				}
			}
		}
		#Revoke Allowed Block?
		revoke_allowed = {
			always = no
		}
		#Ai Will Do Block
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
			}
			modifier = {
				factor = 0.01
				FROM = { trait = content }
			}
			modifier = {
				factor = 0.1
				FROM = {trait = humble}
			}		
			modifier = {
				factor = 2
				FROM = {trait = ambitious}
			}		
			modifier = {
				factor = 1.5
				FROM = {trait = proud}
			}		
			modifier = {
				factor = 0.1
				NOT = {
					FROM = {prestige = 2000}
				}
			}
			modifier = {
				factor = 1.5
				FROM = {prestige = 4000}
			}
			modifier = {
				factor = 2
				FROM = {prestige = 8000}
			}
			modifier = {
				factor = 6.5
				FROM = {prestige = 16000}
			}
		}
	}
## /Create Empire




##--################################################################
##	Create Titular Duchy From County
##--################################################################
	da_create_titular_duchy = {
		#Filter Block - Ai Filter Block
		filter = realm_owned
		ai_target_filter = primary_title 
		
		#From potential Block - "The Decider"
		from_potential = {
			higher_real_tier_than = BARON
			has_dlc = "Charlemagne"
			is_playable = yes
			ai = no
		}
		#Potential Block - Title in Question
		potential = {
			is_title_active = yes
			real_tier = COUNT
			holder_scope = {
				OR = { 
					character = FROM
					any_liege = {
						character = FROM
					}
				}
			}
			#holder_scope = {character = FROM}
		}
		
		#Allow Block
		allow = {
			FROM = {
				custom_tooltip = {
					text = da_ttip_adult_free_capable_independent
					hidden_tooltip = {
						is_adult = yes
						prisoner = no
						NOT = { trait = incapable }
						independent = yes
					}
				}
				prestige = 200
				piety = 200
				wealth = 200
				custom_tooltip = {
					text = da_ttip_relighead_approve50
					hidden_tooltip = {
						OR = {
							rightful_religious_head_scope = {
								opinion = { who = FROM value = 50 }
							}
							NOT = {
								rightful_religious_head_scope = {
									always = yes
								}
							}
						}
					}
				}		
				custom_tooltip = {
					text = da_ttip_duke_realm_size
					hidden_tooltip = {
						OR = {
							realm_size = 8
							any_demesne_title = {
								count = 3
								real_tier = COUNT
							}
							any_demesne_title = {
								count = 1
								higher_real_tier_than = COUNT
							}
						}
					}
				}
			}
			ROOT = {
				custom_tooltip = {
					text = da_ttip_previously_created_from
					hidden_tooltip = {
						NOT = {has_title_flag = customtitle_created}
					}
				}
			}
		}
		
		#Effect Block
		effect = {
			FROM = {
				#New Title
				ROOT = {
					create_title = {
						tier = DUKE
						landless = no
						temporary = no
						custom_created = yes
						culture = FROM
						holder = FROM
						base_title = THIS
						copy_title_laws = yes
					}
					hidden_tooltip = {
						new_title = {	
							set_variable = {
								which = "customtitle_findme"
								value = 1
							}
						}
						FROM = {
							primary_title = {
								ROOT = {
									kingdom = {
										FROM = {
											any_demesne_title = {
												limit = {
													real_tier = DUKE
													check_variable = {which = "customtitle_findme" value = 1} 
												}
												de_jure_liege = PREVPREV
												
												if = {
													limit = {
														FROM = {
															any_demesne_title = {
																count = 2
																higher_real_tier_than = COUNT
															}	
														}
													}
													copy_title_laws = PREVPREVPREVPREV
												}
												set_variable = {
													which = "customtitle_findme"
													value = 0
												}
											}
										}
									}
								}
							}
						}
						set_title_flag = customtitle_created
					}
				}
				#Costs
				wealth = -200
				piety = -200
				prestige = 200
				custom_tooltip = { text = da_ttip_new_duchy }
				#chronicle = {
				#	entry = CHRONICLE_FOUNDED_NEW_KINGDOM_OR_EMPIRE
				#	portrait = [From.GetID]
				#}
			}
		}
		#Revoke Allowed Block?
		revoke_allowed = {
			always = no
		}
		#Ai Will Do Block
		ai_will_do = {
		}
	}
##	/Create Titular Duchy



##--################################################################
##	Create Titular Kingdom From Duchy
##--################################################################
	da_create_titular_kingdom = {
		#Filter Block - Ai Filter Block
		filter = realm_owned
		ai_target_filter = primary_title 
		
		#From potential Block - "The Decider"
		from_potential = {
			higher_real_tier_than = COUNT
			has_dlc = "Charlemagne"
			is_playable = yes
			ai = no
		}
		#Potential Block - Title in Question
		potential = {
			is_title_active = yes
			real_tier = DUKE
			OR = {
				AND = {
					has_holder = no
					FROM = { completely_controls = ROOT }
				}
				holder_scope = {
					OR = { 
						character = FROM
						any_liege = {
							character = FROM
						}
					}
				}
			}
			#holder_scope = {character = FROM}
		}
		
		#Allow Block
		allow = {
			FROM = {
				custom_tooltip = {
					text = da_ttip_adult_free_capable_independent
					hidden_tooltip = {
						is_adult = yes
						prisoner = no
						NOT = { trait = incapable }
						independent = yes
					}
				}
				prestige = 400
				piety = 200
				wealth = 400
				custom_tooltip = {
					text = da_ttip_relighead_approve75
					hidden_tooltip = {
						OR = {
							rightful_religious_head_scope = {
								opinion = { who = FROM value = 75 }
							}
							NOT = {
								rightful_religious_head_scope = {
									always = yes
								}
							}
						}
					}
				}		
				custom_tooltip = {
					text = da_ttip_king_realm_size
					hidden_tooltip = {
						OR = {
							realm_size = 35
							any_demesne_title = {
								count = 3
								real_tier = DUKE
							}
							any_demesne_title = {
								count = 1
								higher_real_tier_than = DUKE
							}
						}
					}
				}
			}
			ROOT = {
				custom_tooltip = {
					text = da_ttip_previously_created_from
					hidden_tooltip = {
						NOT = { has_title_flag = customtitle_created}
					}
				}
			}
		}
		#Effect Block
		effect = {
			FROM = {
				#New Title
				ROOT = {
					create_title = {
						tier = KING
						landless = no
						temporary = no
						custom_created = yes
						culture = FROM
						holder = FROM
						base_title = THIS
						copy_title_laws = yes
					}
					hidden_tooltip = {
						new_title = {	
							set_variable = {
								which = "customtitle_findme"
								value = 1
							}
						}
						FROM = {
							primary_title = {
								ROOT = {
									empire = {
										FROM = {
											any_demesne_title = {
												limit = {
													real_tier = KING
													check_variable = {which = "customtitle_findme" value = 1} 
												}
												de_jure_liege = PREVPREV
												if = {
													limit = {
														FROM = {
															any_demesne_title = {
																count = 2
																higher_real_tier_than = DUKE
															}	
														}
													}
													copy_title_laws = PREVPREVPREVPREV
												}
												set_variable = {
													which = "customtitle_findme"
													value = 0
												}
											}
										}
									}
								}
							}
						}
						set_title_flag = customtitle_created
					}
				}
				#Costs
				if = {
					limit = {
						piety = 1000
					}
					wealth = -200
				}
				if = {
					limit = {
						AND = {
							piety = 800
							NOT = { piety = 1000}
						}
					}
					wealth = -250
				}
				if = {
					limit = {
						AND = {
							piety = 600
							NOT = { piety = 800}
						}
					}
					wealth = -300
				}
				if = {
					limit = {
						AND = {
							piety = 400
							NOT = { piety = 600}
						}
					}
					wealth = -350
				}
				if = {
					limit = {
						NOT = { piety = 400}
					}
					wealth = -400
				}
				piety = -200
				prestige = 400
				custom_tooltip = { text = form_new_kingdom_tooltip }
				chronicle = {
					entry = CHRONICLE_FOUNDED_NEW_KINGDOM_OR_EMPIRE
					portrait = [From.GetID]
				}
			}
		}
		#Revoke Allowed Block?
		revoke_allowed = {
			always = no
		}
		#Ai Will Do Block
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.25
			}
			modifier = {
				factor = 0.01
				FROM = { trait = content }
			}
			modifier = {
				factor = 0.1
				FROM = {trait = humble}
			}		
			modifier = {
				factor = 2
				FROM = {trait = ambitious}
			}		
			modifier = {
				factor = 1.5
				FROM = {trait = proud}
			}		
			modifier = {
				factor = 0.1
				NOT = {
					FROM = {prestige = 1000}
				}
			}
			modifier = {
				factor = 1.5
				FROM = {prestige = 2000}
			}
			modifier = {
				factor = 2
				FROM = {prestige = 4000}
			}
			modifier = {
				factor = 6.5
				FROM = {prestige = 8000}
			}
		}
	}
##	/Create Titular Kingdom


##--################################################################
##	Create Empire From Kingdom
##--################################################################
	da_create_titular_empire = {
		#Filter Block - Ai Filter Block
		filter = realm_owned
		ai_target_filter = primary_title 
		
		#From potential Block - "The Decider"
		from_potential = {
			higher_real_tier_than = DUKE
			has_dlc = "Charlemagne"
			is_playable = yes
			is_nomadic = no
			ai = no
		}
		#Potential Block - Title in Question
		potential = {
			is_title_active = yes
			real_tier = KING
			OR = {
				AND = {
					has_holder = no
					FROM = { completely_controls = ROOT }
				}
				holder_scope = {
					OR = { 
						character = FROM
						any_liege = {
							character = FROM
						}
					}
				}
			}
			#holder_scope = {character = FROM}
		}
		#Allow Block
		allow = {
			FROM = {
				custom_tooltip = {
					text = da_ttip_adult_free_capable_independent
					hidden_tooltip = {
						is_adult = yes
						prisoner = no
						NOT = { trait = incapable }
						independent = yes
					}
				}
				prestige = 800
				piety = 400
				wealth = 800
				custom_tooltip = {
					text = da_ttip_relighead_approve100
					hidden_tooltip = {
						OR = {
							rightful_religious_head_scope = {
								opinion = { who = FROM value = 100 }
							}
							NOT = {
								rightful_religious_head_scope = {
									always = yes
								}
							}
						}
					}
				}		
				custom_tooltip = {
					text = da_ttip_emperor_realm_size
					hidden_tooltip = {
						OR = {
							realm_size = 180
							any_demesne_title = {
								count = 3
								real_tier = KING
							}
							any_demesne_title = {
								count = 1
								higher_real_tier_than = KING
							}
						}
					}
				}
			}
			ROOT = {
				custom_tooltip = {
					text = da_ttip_previously_created_from
					hidden_tooltip = {
						NOT = { has_title_flag = customtitle_created}
					}
				}
			}
		}
		#Effect Block
		effect = {
			FROM = {
				#New Title
				ROOT = {
					create_title = {
						tier = EMPEROR
						landless = no
						temporary = no
						custom_created = yes
						culture = FROM
						holder = FROM
						base_title = THIS
						copy_title_laws = yes
					}
					hidden_tooltip = {
						new_title = {	
							set_variable = {
								which = "customtitle_findme"
								value = 1
							}
						}
						FROM = {
							primary_title = {
								holder_scope = {
									any_demesne_title = {
										limit = {
											real_tier = EMPEROR
											check_variable = {which = "customtitle_findme" value = 1} 
										}
										if = {
											limit = {
												FROM = {
													any_demesne_title = {
														count = 2
														higher_real_tier_than = KING #WHY!?!?!?!?!?!
													}	
												}
											}
											copy_title_laws = PREVPREV
										}
										set_variable = {
											which = "customtitle_findme"
											value = 0
										}
									}
								}
							}
						}
						set_title_flag = customtitle_created
					}
				}
				#Costs
				if = {
					limit = {
						piety = 1200
					}
					wealth = -400
				}
				if = {
					limit = {
						AND = {
							piety = 1000
							NOT = { piety = 1200}
						}
					}
					wealth = -500
				}
				if = {
					limit = {
						AND = {
							piety = 800
							NOT = { piety = 1000}
						}
					}
					wealth = -600
				}
				if = {
					limit = {
						AND = {
							piety = 600
							NOT = { piety = 800}
						}
					}
					wealth = -700
				}
				if = {
					limit = {
						NOT = { piety = 600}
					}
					wealth = -800
				}
				piety = -400
				prestige = 800
				custom_tooltip = { text = form_new_empire_tooltip }
				chronicle = {
					entry = CHRONICLE_FOUNDED_NEW_KINGDOM_OR_EMPIRE
					portrait = [From.GetID]
				}
			}
		}
		#Revoke Allowed Block?
		revoke_allowed = {
			always = no
		}
		#Ai Will Do Block
		ai_will_do = {
			factor = 1
			modifier = {
				factor = 0.1
			}
			modifier = {
				factor = 0.01
				FROM = { trait = content }
			}
			modifier = {
				factor = 0.1
				FROM = {trait = humble}
			}		
			modifier = {
				factor = 2
				FROM = {trait = ambitious}
			}		
			modifier = {
				factor = 1.5
				FROM = {trait = proud}
			}		
			modifier = {
				factor = 0.1
				NOT = {
					FROM = {prestige = 2000}
				}
			}
			modifier = {
				factor = 1.5
				FROM = {prestige = 4000}
			}
			modifier = {
				factor = 2
				FROM = {prestige = 8000}
			}
			modifier = {
				factor = 6.5
				FROM = {prestige = 16000}
			}
		}
	}
## /Create Titular Empire
}

##--################################################################
##	/Dejure Adjudication Mod - Have a nice day!
##--################################################################
